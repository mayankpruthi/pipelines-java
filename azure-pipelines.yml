# Maven
# Build your Java project and run tests with Apache Maven.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/java

trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- task: Bash@3
  inputs:
    targetType: 'inline'
    script: |
      i=0
            while [ $i -lt 30 ]
            do
                curl --location --request POST 'https://dev.armorcode.ai/client/utils/jenkins/build/validation' --header 'Content-Type: application/json' --header 'Authorization: Bearer 86e0f7b5-9830-4cab-ac5b-1d0d69624fb2'  -d '{ "env": "Production", "product": "92", "subProduct": "113", "buildNumber": "'"$[Release.DeploymentID]"'", "jobName":"'"$JOB_NAME"'"}' > result.json
                status=$(jq -r '.status' result.json)
                if [ $status = "HOLD" ]
                then
                    sleep 10
                    i=$(( $i + 1 ))
                    if [ $i = 30 ]
                    then
                        exit 1
                    else
                        continue
                    fi
                else
                    break
                fi
            done
