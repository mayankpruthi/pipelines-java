# Maven
# Build your Java project and run tests with Apache Maven.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/java

trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- task: Bash@3
  inputs:
    targetType: 'inline'
    script: |
      i=0
            while [ $i -lt 30 ]
            do
                curl --location --request POST 'https://preprod.armorcode.ai/client/utils/jenkins/build/validation' --header 'Content-Type: application/json' --header 'Authorization: Bearer 2872cc2d-e0b7-4db3-a863-f3f485e06cac'  -d '{ "env": "Production", "product": "226", "subProduct": "354", "buildNumber": "$(Build.BuildId)"}' > result.json
                status=$(jq -r '.status' result.json)
                if [ $status = "HOLD" ]
                then
                    sleep 10
                    i=$(( $i + 1 ))
                    if [ $i = 30 ]
                    then
                        exit 1
                    else
                        continue
                    fi
                else
                    break
                fi
            done
